---
processes:
- name: service-fabrik-apiserver
  executable: /var/vcap/packages/apiserver/bin/kube-apiserver
  args:
  - --anonymous-auth=true
  - --allow-privileged=false
  - --apiserver-count=<%= link('service-fabrik-apiserver').instances.size %>
  - --bind-address=0.0.0.0
  - --enable-bootstrap-token-auth
  - --enable-swagger-ui
  - --etcd-servers=<%=p('etcd.url') %>
  - --etcd-cafile=/var/vcap/jobs/service-fabrik-apiserver/config/etcd-ca.crt
  - --etcd-certfile=/var/vcap/jobs/service-fabrik-apiserver/config/etcd.crt
  - --etcd-keyfile=/var/vcap/jobs/service-fabrik-apiserver/config/etcd.key
  - --kubelet-https
  - --repair-malformed-updates=false
  - --secure-port=<%=p('port') %>
  - --service-account-lookup
  - --tls-cert-file=/var/vcap/jobs/service-fabrik-apiserver/config/apiserver.pem
  - --tls-private-key-file=/var/vcap/jobs/service-fabrik-apiserver/config/apiserver-key.pem
  - --token-auth-file=/var/vcap/jobs/service-fabrik-apiserver/config/tokens.csv
  - --storage-media-type=application/json
  - --enable-aggregator-routing
  - --v=<%=p('logging-level') %>
  - --authorization-mode=AlwaysAllow
  - --runtime-config=api/v1,rbac.authorization.k8s.io/v1alpha1
  - --client-ca-file=/var/vcap/jobs/service-fabrik-apiserver/config/apiserver.pem
  env: