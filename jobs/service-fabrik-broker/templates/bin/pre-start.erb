#!/bin/bash

set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables

if [ ! -L /etc/init/keepalived.conf ]; then
   ln -s /var/vcap/jobs/service-fabrik-broker/config/keepalived/upstart.conf /etc/init/keepalived.conf
fi

mkdir -p /etc/keepalived

if [ ! -L /etc/init/keepalived.conf ]; then
   ln -s /var/vcap/jobs/service-fabrik-broker/config/keepalived/keepalived.conf /etc/keepalived/keepalived.conf
fi

if [ ! -L /etc/keepalived/get_sf_broker_status.sh ]; then
   ln -s /var/vcap/jobs/service-fabrik-broker/config/keepalived/get_agent_status.sh /etc/keepalived/get_sf_broker_status.sh
fi

if [ ! -L /etc/keepalived/get_sf_broker_status.sh ]; then
   ln -s /var/vcap/jobs/service-fabrik-broker/config/keepalived/notify.sh /etc/keepalived/notify.sh
fi

if [ ! -L /etc/keepalived/get_sf_broker_status.sh ]; then
   ln -s /var/vcap/jobs/service-fabrik-broker/config/keepalived/master.sh /etc/keepalived/master.sh
fi

if [ ! -L /etc/keepalived/get_sf_broker_status.sh ]; then
   ln -s /var/vcap/jobs/service-fabrik-broker/config/keepalived/get_keepalived_state.sh /etc/keepalived/get_keepalived_state.sh
fi

chmod +x /etc/keepalived/get_sf_broker_status.sh
chmod +x /etc/keepalived/notify.sh
chmod +x /etc/keepalived/master.sh
chmod +x /etc/keepalived/get_keepalived_state.sh

sudo service keepalived restart
